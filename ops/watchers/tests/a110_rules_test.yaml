# Testes sintéticos para promtool (regras acima)
# Rodar: promtool test rules ops/watchers/tests/a110_rules_test.yaml


tests:
- interval: 1m
# Simula buckets de latência para swap crescendo ao longo do tempo
input_series:
- series: 'amm_op_latency_seconds_bucket{le="0.06",op="swap"}'
values: '0+0x5 1+1x20' # começa baixo, depois cresce
- series: 'amm_op_latency_seconds_bucket{le="0.20",op="swap"}'
values: '0+0x5 2+2x20'
alert_rule_test:
- eval_time: 15m
alertname: OBS_P95_Swap_TooHigh
exp_alerts:
- exp_labels: { severity: 'warn' }


- interval: 1m
# Simula baixa cobertura de hooks
input_series:
- series: 'hook_coverage_ratio{env="dev"}'
values: '1x10 0.9x40'
alert_rule_test:
- eval_time: 30m
alertname: OBS_Hook_Coverage_Low
exp_alerts:
- exp_labels: { severity: 'warn' }
