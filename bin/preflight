#!/usr/bin/env bash
set -euo pipefail

ROOT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"
cd "$ROOT_DIR"

# yamllint: lint só alvos da S7 (se existirem)
if command -v yamllint >/dev/null 2>&1; then
  if [ -f tools/yaml/targets.txt ]; then
    # carrega alvos ignorando linhas vazias e comentários
    mapfile -t TARGETS < <(grep -v '^\s*#' tools/yaml/targets.txt | sed '/^\s*$/d')
    if [ "${#TARGETS[@]}" -gt 0 ]; then
      yamllint -c .yamllint "${TARGETS[@]}"
    else
      echo "skip: yamllint (no targets)"
    fi
  else
    echo "skip: yamllint (no targets.txt)"
  fi
else
  echo "skip: yamllint"
fi
