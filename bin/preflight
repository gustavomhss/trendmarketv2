#!/usr/bin/env bash
set -euo pipefail
mkdir -p out/ci out/evidence out/scorecards
python -V
if [ -f scripts/render_ci.py ]; then python scripts/render_ci.py; else echo "skip: render"; fi
if [ -f scripts/validate_ci.py ]; then python scripts/validate_ci.py; else echo "skip: validate"; fi
if command -v yamllint >/dev/null 2>&1; then yamllint .; else echo "skip: yamllint"; fi
pytest -q || true
if command -v gitleaks >/dev/null 2>&1; then gitleaks detect --source . --no-banner --report-format json --report-path out/evidence/T2_security/gitleaks_report.json; else echo "skip: gitleaks"; fi
